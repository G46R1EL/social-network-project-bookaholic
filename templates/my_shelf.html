{% extends "base.html" %}

{% block content %}
    <h2>Minha Estante</h2>
    
    {% if user_books %}
        {% for user_book in user_books %}
            {# Criamos uma instância do formulário para cada livro no loop #}
            {% set form = UpdateBookForm(obj=user_book) %}
            <div class="book-item" style="display: flex; align-items: flex-start; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px;">
                {% if user_book.book.thumbnail %}
                    <img src="{{ user_book.book.thumbnail }}" alt="Capa do livro {{ user_book.book.title }}" style="margin-right: 15px; max-width: 128px;">
                {% else %}
                    <div style="width: 128px; height: 192px; background-color: #f0f0f0; margin-right: 15px; text-align: center; line-height: 192px; color: #aaa; flex-shrink: 0;">Sem capa</div>
                {% endif %}
                <div>
                    <h4>{{ user_book.book.title }}</h4>
                    <p><strong>Autor(es):</strong> {{ user_book.book.authors }}</p>
                    
                    <form action="{{ url_for('update_book', user_book_id=user_book.id) }}" method="POST">
                        {{ form.hidden_tag() }}
                        <div style="margin-bottom: 5px;">
                            {{ form.status.label }} {{ form.status() }}
                        </div>
                        <div style="margin-bottom: 10px;">
                            {{ form.current_page.label }} {{ form.current_page(size=5) }}
                        </div>
                        {{ form.submit() }}
                    </form>
                    </div>
            </div>
        {% endfor %}
    {% else %}
        <p>Você ainda não adicionou nenhum livro à sua estante.</p>
        <p>Vá para a página de <a href="{{ url_for('search') }}">busca</a> para começar!</p>
    {% endif %}
{% endblock %}